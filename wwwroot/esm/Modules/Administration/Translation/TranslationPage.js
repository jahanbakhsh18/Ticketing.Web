import{i as p,o as d}from"../../../_chunks/chunk-3CR6F5J6.js";import{a as l}from"../../../_chunks/chunk-WRJRVQ7L.js";import"../../../_chunks/chunk-TA7MABRS.js";import{c as i,e as y,f as g,g as c}from"../../../_chunks/chunk-RKUHNEJF.js";var f=y((L,v)=>{v.exports=Serenity.Extensions});var C=g(c(),1);var t=g(c(),1),n=g(f(),1);var T,x,u=class u extends(x=t.EntityGrid,T=Symbol.typeInfo,x){getIdProperty(){return"Key"}getLocalTextPrefix(){return"Administration.Translation"}getService(){return p.baseUrl}constructor(e){super(e),this.element.on("keyup."+this.uniqueName+" change."+this.uniqueName,"input.custom-text",r=>{var s=(0,t.trimToNull)((0,t.Fluent)(r.target).val());s===""&&(s=null),this.view.getItemById((0,t.Fluent)(r.target).data("key")).CustomText=s,this.hasChanges=!0})}onClick(e,r,s){var m;if(super.onClick(e,r,s),e.defaultPrevented||(m=e==null?void 0:e.isDefaultPrevented)!=null&&m.call(e))return;let a=this.itemAt(r),o;if((0,t.Fluent)(e.target).hasClass("source-text")){if(e.preventDefault(),o=i(()=>{a.CustomText=a.SourceText,this.view.updateItem(a.Key,a),this.hasChanges=!0},"done"),(0,t.isTrimmedEmpty)(a.CustomText)||(0,t.trimToEmpty)(a.CustomText)===(0,t.trimToEmpty)(a.SourceText)){o();return}(0,t.confirmDialog)(n.TranslationTexts.OverrideConfirmation,o);return}if((0,t.Fluent)(e.target).hasClass("target-text")){if(e.preventDefault(),o=i(()=>{a.CustomText=a.TargetText,this.view.updateItem(a.Key,a),this.hasChanges=!0},"done"),(0,t.isTrimmedEmpty)(a.CustomText)||(0,t.trimToEmpty)(a.CustomText)===(0,t.trimToEmpty)(a.TargetText)){o();return}(0,t.confirmDialog)(n.TranslationTexts.OverrideConfirmation,o);return}}createColumns(){var e=[];return e.push({field:"Key",name:n.TranslationTexts.Key,width:300,sortable:!1}),e.push({field:"SourceText",name:n.TranslationTexts.SourceText,width:300,sortable:!1,format:i(r=>{var s;return l("a",{class:"source-text",children:(s=r.value)!=null?s:""})},"format")}),e.push({field:"CustomText",name:n.TranslationTexts.CustomText,width:300,sortable:!1,format:i(r=>{var s;return l("input",{class:"custom-text",value:(s=r.value)!=null?s:"",type:"text",placeholder:r.item.TargetText,"data-key":r.item.Key})},"format")}),e}createToolbarExtensions(){super.createToolbarExtensions();let e={lookupKey:"Administration.Language"};this.sourceLanguage=t.Widget.create({type:t.LookupEditor,element:i(r=>r.appendTo(this.toolbar.element).attr("placeholder","--- "+n.TranslationTexts.SourceLanguage+" ---"),"element"),options:e}),this.sourceLanguage.changeSelect2(r=>{this.hasChanges?this.saveChanges(this.targetLanguageKey).then(()=>this.refresh()):this.refresh()}),this.targetLanguage=t.Widget.create({type:t.LookupEditor,element:i(r=>r.appendTo(this.toolbar.element).attr("placeholder","--- "+n.TranslationTexts.TargetLanguage+" ---"),"element"),options:e}),this.targetLanguage.changeSelect2(r=>{this.hasChanges?this.saveChanges(this.targetLanguageKey).then(()=>this.refresh()):this.refresh()})}saveChanges(e){var r={};for(let s of this.getItems())r[s.Key]=s.CustomText;return Promise.resolve(p.Update({TargetLanguageID:e,Translations:r})).then(()=>{this.hasChanges=!1,e=(0,t.trimToNull)(e)||"invariant",(0,t.notifySuccess)('User translations in "'+e+'" language are saved to "user.texts.'+e+'.json" file under "~/App_Data/texts/"',"")})}onViewSubmit(){var e=this.view.params;return e.SourceLanguageID=this.sourceLanguage.value,this.targetLanguageKey=this.targetLanguage.value||"",e.TargetLanguageID=this.targetLanguageKey,this.hasChanges=!1,super.onViewSubmit()}getButtons(){return[{title:n.TranslationTexts.SaveChangesButton,onClick:i(e=>this.saveChanges(this.targetLanguageKey).then(()=>this.refresh()),"onClick"),cssClass:"apply-changes-button"}]}createQuickSearchInput(){t.GridUtils.addQuickSearchInputCustom(this.toolbar.element,(e,r)=>{this.searchText=r,this.view.setItems(this.view.getItems(),!0)})}onViewFilter(e){if(!super.onViewFilter(e))return!1;if(!this.searchText)return!0;var r=t.stripDiacritics,s=r(this.searchText).toLowerCase();function a(o){return o?o.toLowerCase().indexOf(s)>=0:!1}return i(a,"match"),(0,t.isEmptyOrNull)(s)||a(e.Key)||a(e.SourceText)||a(e.TargetText)||a(e.CustomText)}usePager(){return!1}};i(u,"TranslationGrid"),u[T]=u.registerClass(d);var h=u;var O=i(()=>(0,C.gridPageInit)(h),"default");export{O as default};
//# sourceMappingURL=TranslationPage.js.map
