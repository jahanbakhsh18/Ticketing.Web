import{a as E,b as S}from"../../../_chunks/chunk-DHWDWM3H.js";import{b as I,f as U,g as C}from"../../../_chunks/chunk-IT32I7HR.js";import{g as x,j as b,k as R,l as P,m as t,n as h}from"../../../_chunks/chunk-HURNHUUS.js";import{a as v}from"../../../_chunks/chunk-WRJRVQ7L.js";import"../../../_chunks/chunk-TA7MABRS.js";import{a as g}from"../../../_chunks/chunk-6YUMKNYN.js";import{c as r,f as p,g as f}from"../../../_chunks/chunk-RKUHNEJF.js";var L=p(f(),1);var D=p(f(),1);var a=p(f(),1);var e=p(f(),1);async function T(u){let s=(await P.List({UserID:u.userID})).Entities,o=(await P.ListRolePermissions({UserID:u.userID})).Entities,n=await(0,e.getRemoteDataAsync)(E.Administration.ImplicitPermissions);var i;new e.Dialog({dialogClass:"s-UserPermissionDialog",title:(0,e.stringFormat)(C.DialogTitle,u.username),buttons:[(0,e.okDialogButton)({click:r(async()=>{await P.Update({UserID:u.userID,Permissions:i.value}),(0,e.notifySuccess)(C.SaveSuccess)},"click")}),(0,e.cancelDialogButton)()],element:r(c=>c.appendChild(v(S,{ref:d=>i=d,showRevoke:!0,value:s,implicitPermissions:n,rolePermissions:o})),"element")})}r(T,"UserPermissionDialog");var k,A,m=class m extends(A=a.EntityDialog,k=Symbol.typeInfo,A){constructor(o){super(o);this.form=new R(this.idPrefix);this.form.Password.change(()=>{a.EditorUtils.setRequired(this.form.PasswordConfirm,this.form.Password.value.length>0)}),this.form.Password.addValidationRule(this.uniqueName,n=>{if(this.form.Password.value.length<6)return(0,a.stringFormat)(I.MinRequiredPasswordLength,6)}),this.form.PasswordConfirm.addValidationRule(this.uniqueName,n=>{if(this.form.Password.value!=this.form.PasswordConfirm.value)return I.PasswordConfirmMismatch})}getFormKey(){return R.formKey}getIdProperty(){return t.idProperty}getIsActiveProperty(){return t.isActiveProperty}getLocalTextPrefix(){return t.localTextPrefix}getNameProperty(){return t.nameProperty}getService(){return h.baseUrl}getToolbarButtons(){let o=super.getToolbarButtons();return o.push({title:U.EditPermissionsButton,cssClass:"edit-permissions-button",icon:"fa-lock text-green",onClick:r(()=>{T({userID:this.entity.UserId,username:this.entity.Username})},"onClick")}),o}updateInterface(){super.updateInterface(),this.toolbar.findButton("edit-permissions-button").toggleClass("disabled",this.isNewOrDeleted())}afterLoadEntity(){super.afterLoadEntity(),this.form.Password.element.toggleClass("required",this.isNew()).closest(".field").findFirst("sup").toggle(this.isNew()),this.form.PasswordConfirm.element.toggleClass("required",this.isNew()).closest(".field").findFirst("sup").toggle(this.isNew())}};r(m,"UserDialog"),m[k]=m.registerClass(g);var y=m;var B,F,l=class l extends(F=D.EntityGrid,B=Symbol.typeInfo,F){getColumnsKey(){return b.columnsKey}getDialogType(){return y}getIdProperty(){return t.idProperty}getIsActiveProperty(){return t.isActiveProperty}getLocalTextPrefix(){return t.localTextPrefix}getService(){return h.baseUrl}constructor(s){super(s)}getDefaultSortBy(){return[t.Fields.Username]}createIncludeDeletedButton(){}createColumns(){var s=super.createColumns(),o=(0,D.tryFirst)(s,i=>i.field==t.Fields.Roles);if(o){var n;x.getLookupAsync().then(i=>{n=i,this.sleekGrid.invalidate()}),o.format=i=>{if(!n)return v("i",{class:"fa fa-spinner"});var c=(i.value||[]).map(d=>(n.itemById[d]||{}).RoleName||"");return c.sort(),c.map(d=>i.escape(d)).join(", ")}}return s}};r(l,"UserGrid"),l[B]=l.registerClass(g);var w=l;var oe=r(()=>(0,L.gridPageInit)(w),"default");export{oe as default};
//# sourceMappingURL=UserPage.js.map
